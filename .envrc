# Auto-load environment variables
# Install: brew install direnv
# Activate: eval "$(direnv hook zsh)"

# NOTE: Using apps/backend/venv instead of direnv's layout python
# This ensures consistent Python environment across all tools (Makefile, scripts, etc.)
# If you want to use direnv's layout python instead, uncomment the line below
# and remove the PATH_add apps/backend/venv/bin line
# layout python python3

# Load .env file (single source of truth at project root)
dotenv_if_exists .env

# If DATABASE_URL not set from .env files, try Keychain fallback
if [ -z "$DATABASE_URL" ]; then
    export DATABASE_URL=$(security find-generic-password -s "easypost-database-url" -w 2>/dev/null)
fi

# Add local bin to PATH
PATH_add apps/backend/venv/bin
PATH_add node_modules/.bin

# Export common vars
export PYTHONPATH="${PWD}/apps/backend/src:${PYTHONPATH}"
export NODE_ENV=${ENVIRONMENT:-development}
# ENVIRONMENT is now controlled by .env files, don't override

# Allow direnv
# Run: direnv allow
